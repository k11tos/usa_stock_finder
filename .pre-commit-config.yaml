# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
repos:
# Custom local hook for sensitive file detection
-   repo: local
    hooks:
    -   id: check-sensitive-files
        name: Check for sensitive files
        entry: |
            bash -c '
            RED="\033[0;31m"
            GREEN="\033[0;32m"
            YELLOW="\033[1;33m"
            NC="\033[0m"
            ISSUES_FOUND=0
            echo "ğŸ” Pre-commit hook: Checking for sensitive files..."
            STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
            if [ -z "$STAGED_FILES" ]; then
                echo "âœ… No files staged for commit"
                exit 0
            fi
            echo "ğŸ“ Checking file names..."
            SENSITIVE_PATTERNS=(
                "\.env$"
                "\.env\..*"
                "portfolio/.*\.csv$"
                "data/.*\.json$"
                "token\.dat$"
                ".*secret.*"
                ".*password.*"
                ".*key.*\.pem$"
                ".*\.key$"
            )
            for file in $STAGED_FILES; do
                for pattern in "${SENSITIVE_PATTERNS[@]}"; do
                    if echo "$file" | grep -qiE "$pattern"; then
                        echo -e "${RED}âŒ Error: Sensitive file detected: $file${NC}"
                        echo -e "${YELLOW}   Pattern matched: $pattern${NC}"
                        echo -e "${YELLOW}   This file should not be committed!${NC}"
                        ISSUES_FOUND=1
                    fi
                done
            done
            echo "ğŸ” Checking file contents for hardcoded secrets..."
            for file in $STAGED_FILES; do
                if [[ "$file" == *"/test"* ]] || [[ "$file" == *"test_"* ]] || [[ "$file" == *.pyc ]] || [[ "$file" == *.pyo ]]; then
                    continue
                fi
                if git diff --cached "$file" 2>/dev/null | grep -q "^diff --git"; then
                    FILE_CONTENT=$(git show ":$file" 2>/dev/null)
                    if [ -n "$FILE_CONTENT" ]; then
                        if echo "$FILE_CONTENT" | grep -qiE "ki_app_key\s*=\s*\"[^\"]{15,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: ki_app_key${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "ki_app_secret_key\s*=\s*\"[^\"]{15,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: ki_app_secret_key${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "TELEGRAM_BOT_TOKEN\s*=\s*\"[^\"]{15,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: TELEGRAM_BOT_TOKEN${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "account_number\s*=\s*\"[^\"]{10,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: account_number${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "api_key\s*=\s*\"[^\"]{15,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: api_key${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "secret\s*=\s*\"[^\"]{15,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: secret${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                        if echo "$FILE_CONTENT" | grep -qiE "password\s*=\s*\"[^\"]{10,}\""; then
                            echo -e "${RED}âŒ Error: Hardcoded secret detected in: $file${NC}"
                            echo -e "${YELLOW}   Pattern: password${NC}"
                            echo -e "${YELLOW}   Please use environment variables instead!${NC}"
                            ISSUES_FOUND=1
                        fi
                    fi
                fi
            done
            if [ $ISSUES_FOUND -eq 1 ]; then
                echo ""
                echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${RED}â•‘  COMMIT BLOCKED: Sensitive information detected!       â•‘${NC}"
                echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo ""
                echo "ğŸ’¡ Tips:"
                echo "   - Use .env file for secrets (already in .gitignore)"
                echo "   - Use environment variables in code: os.getenv(\"KEY_NAME\")"
                echo "   - Check .gitignore to ensure sensitive files are excluded"
                echo ""
                exit 1
            else
                echo -e "${GREEN}âœ… All checks passed. Proceeding with commit...${NC}"
                exit 0
            fi
            '
        language: system
        pass_filenames: false
        always_run: true
        description: Prevents committing sensitive files like .env, portfolio.csv, etc.
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: check-yaml
    -   id: check-added-large-files
-   repo: https://github.com/psf/black
    rev: 24.4.2
    hooks:
    - id: black
      language_version: python3.12
      args: ["--line-length", "120"]
- repo: https://github.com/myint/autoflake
  rev: v2.3.1
  hooks:
    - id: autoflake
      args:
        - --in-place
        - --remove-unused-variables
        - --remove-all-unused-imports
        - --expand-star-imports
-   repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
    - id: flake8
      args: [--max-line-length=120]
- repo: https://github.com/pycqa/isort
  rev: 5.13.2
  hooks:
    - id: isort
      name: isort (python)
      args: ["--profile", "black", "--line-length", "120"]

# Advanced tools temporarily disabled for compatibility
# - repo: https://github.com/pre-commit/mirrors-mypy
#   rev: v1.8.0
#   hooks:
#     - id: mypy
#       additional_dependencies: [types-requests, types-PyYAML, types-python-dateutil]

# - repo: https://github.com/PyCQA/bandit
#   rev: 1.7.5
#   hooks:
#     - id: bandit
#       args: ["-r", ".", "-f", "json", "-o", "bandit-report.json"]

# - repo: https://github.com/jendrikseipp/vulture
#   rev: v2.11
#   hooks:
#     - id: vulture
#       args: ["--min-confidence", "80"]
#       files: \.py$

default_language_version:
  python: python3.12
